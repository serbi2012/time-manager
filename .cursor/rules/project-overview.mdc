---
description: 업무 시간 관리 프로젝트의 전체 개요, 아키텍처, 데이터 구조, 컴포넌트 설명
globs:
alwaysApply: false
---

# 업무 시간 관리 (Time Manager) 프로젝트

## 프로젝트 개요

하루 동안 회사에서 수행한 작업을 실시간으로 기록하고 관리하는 웹 애플리케이션입니다.
타이머 기반으로 작업 시간을 측정하고, 일간/주간 단위로 작업 기록을 조회할 수 있습니다.

### 주요 기능

-   **실시간 타이머**: 작업 시작/정지/전환
-   **작업 기록 관리**: 작업 추가, 수정, 삭제(휴지통), 완료 처리
-   **작업 프리셋**: 자주 사용하는 작업을 템플릿으로 저장, 드래그앤드롭으로 순서 변경
-   **일간 간트차트**: 하루의 작업 시각화, 드래그로 작업 추가
-   **주간 일정**: 주간 작업 조회 및 복사 형식 제공, 관리업무 필터
-   **게스트 모드**: 로그인 없이 LocalStorage 기반으로 데이터 저장/사용 가능
-   **클라우드 동기화**: Firebase를 통한 실시간 데이터 동기화 (로그인 시)
-   **반응형 UI**: 데스크탑/모바일 완전 분리된 UI 제공

---

## 기술 스택

### Core

-   **React 19** - UI 라이브러리
-   **TypeScript 5.9** - 정적 타입
-   **Vite 7** - 빌드 도구

### State Management

-   **Zustand 5** - 전역 상태 관리
    -   **zustand/middleware/persist** - LocalStorage 영속화 (게스트 모드)

### Backend / Database

-   **Firebase 12** - 백엔드 서비스
    -   **Firestore** - 클라우드 데이터베이스
    -   **Firebase Auth** - Google 소셜 로그인

### UI Components

-   **Ant Design 6** - UI 컴포넌트 라이브러리

### Testing

-   **Vitest** - 테스트 프레임워크
-   **@testing-library/react** - React 테스트 유틸리티

---

## 프로젝트 구조 (Feature-Slice Design)

```
src/
├── app/                              # 앱 진입점 및 설정
│   ├── App.tsx                       # 루트 컴포넌트 (Provider + Router)
│   ├── providers/                    # 전역 Provider
│   │   └── ThemeProvider.tsx         # Ant Design 테마 설정
│   └── layouts/                      # 플랫폼별 레이아웃
│       ├── DesktopLayout.tsx         # 데스크탑 전용 레이아웃
│       └── MobileLayout.tsx          # 모바일 전용 레이아웃
│
├── pages/                            # 페이지 컴포넌트
│   ├── DailyPage/                    # 일간 페이지
│   │   ├── index.tsx                 # 플랫폼 스위칭
│   │   ├── DesktopDailyPage.tsx      # 데스크탑 일간 페이지
│   │   └── MobileDailyPage.tsx       # 모바일 일간 페이지
│   └── WeeklyPage.tsx                # 주간 페이지
│
├── widgets/                          # 조합 위젯 (레이아웃 블록)
│   ├── Header/                       # 헤더 위젯
│   │   ├── DesktopHeader.tsx         # 데스크탑 헤더
│   │   ├── MobileHeader.tsx          # 모바일 헤더
│   │   ├── HeaderContent.tsx         # 공통 로고/타이틀
│   │   └── UserMenu.tsx              # 사용자 메뉴
│   │
│   ├── Navigation/                   # 네비게이션 위젯
│   │   ├── DesktopSidebar.tsx        # 데스크탑 사이드바
│   │   ├── MobileBottomNav.tsx       # 모바일 하단 네비게이션
│   │   └── MobilePresetDrawer.tsx    # 모바일 프리셋 드로어
│   │
│   └── SyncStatus/                   # 동기화 상태 위젯
│       └── SyncIndicator.tsx         # 동기화 인디케이터
│
├── features/                         # 기능별 모듈 (핵심!)
│   ├── timer/                        # 타이머 기능
│   │   └── model/types.ts            # TimerSlice 타입
│   │
│   ├── work-record/                  # 작업 기록 기능
│   │   ├── model/types.ts            # RecordSlice 타입
│   │   ├── lib/                      # 순수 함수
│   │   │   ├── conflict_detector.ts  # 시간 충돌 감지
│   │   │   ├── record_merger.ts      # 레코드 병합
│   │   │   └── duration_calculator.ts # 시간 계산
│   │   └── ui/                       # UI 컴포넌트
│   │       ├── SessionEditor/        # 세션 편집
│   │       ├── RecordTable/          # 레코드 테이블 헤더/액션
│   │       ├── CompletedRecords/     # 완료/휴지통 모달
│   │       └── MobileRecordCard/     # 모바일 레코드 카드
│   │
│   ├── work-template/                # 작업 프리셋 기능
│   │   ├── model/types.ts            # TemplateSlice 타입
│   │   └── ui/                       # UI 컴포넌트
│   │       ├── TemplateCard.tsx      # 템플릿 카드
│   │       └── ColorPicker.tsx       # 색상 선택기
│   │
│   ├── gantt-chart/                  # 간트 차트 기능
│   │   ├── lib/                      # 순수 함수
│   │   │   ├── slot_calculator.ts    # 슬롯 계산
│   │   │   └── drag_handler.ts       # 드래그 핸들러
│   │   └── ui/                       # UI 컴포넌트
│   │       ├── GanttChart/           # 간트 차트 구성요소
│   │       └── ResizeHandle/         # 리사이즈 핸들
│   │
│   ├── weekly-schedule/              # 주간 일정 기능
│   │   ├── lib/copy_formatter.ts     # 복사 포맷터
│   │   └── ui/                       # UI 컴포넌트
│   │       ├── DayColumn.tsx         # 요일 컬럼
│   │       └── CopyFormatSelector.tsx # 복사 형식 선택
│   │
│   ├── settings/                     # 설정 기능
│   │   ├── model/types.ts            # 설정 관련 타입
│   │   └── ui/tabs/                  # 설정 탭 컴포넌트
│   │       ├── DataTab.tsx           # 데이터 관리
│   │       ├── ThemeTab.tsx          # 테마 설정
│   │       ├── ShortcutsTab.tsx      # 단축키 설정
│   │       └── AutoCompleteTab.tsx   # 자동완성 설정
│   │
│   ├── admin/                        # 관리자 기능
│   │   ├── lib/                      # 순수 함수
│   │   │   ├── problem_detector.ts   # 문제 세션 감지
│   │   │   └── conflict_finder.ts    # 충돌 탐지
│   │   └── ui/                       # UI 컴포넌트
│   │       ├── AdminDashboard/       # 관리자 대시보드
│   │       ├── SessionsTab/          # 세션 탭 (충돌/문제)
│   │       └── RecordsTab/           # 레코드 탭 (중복)
│   │
│   └── sync/                         # 동기화 기능
│       └── hooks/useSyncStatus.ts    # 동기화 상태 훅
│
├── shared/                           # 공유 리소스
│   ├── lib/                          # 순수 유틸리티
│   │   ├── time/                     # 시간 관련
│   │   │   ├── calculators.ts        # timeToMinutes, minutesToTime
│   │   │   ├── formatters.ts         # formatDuration, formatTimer
│   │   │   └── validators.ts         # isValidTimeFormat
│   │   ├── lunch/                    # 점심시간 계산
│   │   │   └── lunch_calculator.ts
│   │   └── session/                  # 세션 유틸
│   │       └── session_utils.ts
│   │
│   ├── types/                        # 공유 타입 정의
│   │   ├── domain.ts                 # WorkRecord, WorkSession, WorkTemplate
│   │   ├── timer.ts                  # TimerState
│   │   ├── shortcut.ts               # ShortcutDefinition
│   │   └── suggestion.ts             # 건의사항 타입
│   │
│   ├── config/                       # 상수 및 설정
│   │   ├── constants.ts              # DEFAULT_TASK_OPTIONS 등
│   │   └── theme.ts                  # AppTheme, APP_THEME_COLORS
│   │
│   ├── ui/                           # 공유 UI 컴포넌트
│   │   ├── TimeInput.tsx
│   │   ├── DateInput.tsx
│   │   ├── CategoryTag.tsx
│   │   ├── DurationDisplay.tsx
│   │   └── TimerDisplay.tsx
│   │
│   └── hooks/                        # 공유 훅
│       └── useResponsive.ts          # 반응형 감지
│
├── components/                       # 기존 컴포넌트 (마이그레이션 대상)
├── store/                            # Zustand 스토어
├── firebase/                         # Firebase 연동
│
└── test/                             # 테스트
    ├── unit/                         # 순수 함수 유닛 테스트
    │   ├── shared/lib/               # 공유 라이브러리 테스트
    │   └── features/*/lib/           # 기능별 lib 테스트
    ├── component/                    # UI 컴포넌트 테스트
    │   └── features/*/               # 기능별 컴포넌트 테스트
    ├── components/                   # 기존 컴포넌트 테스트
    └── helpers/                      # 테스트 헬퍼
        └── mock_factory.ts           # 목 데이터 팩토리
```

---

## 데이터 구조 (Types)

타입 정의는 `shared/types/`에서 참조:

### WorkSession

```typescript
interface WorkSession {
    id: string;
    date: string; // YYYY-MM-DD
    start_time: string; // HH:mm
    end_time: string; // HH:mm (빈 문자열이면 진행 중)
    duration_minutes: number;
}
```

### WorkRecord

```typescript
interface WorkRecord {
    id: string;
    project_code: string;
    work_name: string;
    task_name: string;
    deal_name: string;
    category_name: string;
    duration_minutes: number;
    note: string;
    start_time: string;
    end_time: string;
    date: string;
    sessions: WorkSession[];
    is_completed: boolean;
    completed_at?: string;
    is_deleted?: boolean;
    deleted_at?: string;
}
```

### WorkTemplate

```typescript
interface WorkTemplate {
    id: string;
    project_code: string;
    work_name: string;
    task_name: string;
    deal_name: string;
    category_name: string;
    note: string;
    color: string;
    created_at: string;
}
```

### TimerState

```typescript
interface TimerState {
    is_running: boolean;
    start_time: number | null;
    active_template_id: string | null;
    active_form_data: WorkFormData | null;
    active_record_id: string | null;
    active_session_id: string | null;
}
```

---

## 아키텍처 원칙

### 1. 모바일/데스크탑 완전 분리

```
App.tsx
  ├── DesktopLayout (is_mobile === false)
  │     ├── DesktopHeader
  │     ├── DesktopSidebar
  │     └── DesktopDailyPage
  │
  └── MobileLayout (is_mobile === true)
        ├── MobileHeader
        ├── MobileDailyPage
        └── MobileBottomNav
```

-   **핵심**: 모바일 변경이 데스크탑에 영향을 주지 않음
-   플랫폼별 독립적인 컴포넌트 트리

### 2. 순수 함수 우선

-   모든 계산 로직은 `lib/` 폴더에 순수 함수로 분리
-   부수 효과(Firebase, Store 업데이트)는 `model/` 또는 `api/`에서만

### 3. 단방향 의존성

```
pages → widgets → features → shared
         ↓
      features 간 직접 import 금지 (shared를 통해서만)
```

### 4. Public API (index.ts)

-   각 feature는 `index.ts`를 통해서만 export
-   내부 구현 숨김

### 5. Co-location

-   관련 파일(컴포넌트, 테스트)은 같은 폴더에

---

## 주요 공유 함수

### 시간 유틸 (shared/lib/time)

```typescript
// 계산
timeToMinutes("09:30"); // 570
minutesToTime(570); // "09:30"

// 포맷팅
formatDuration(90); // "1시간 30분"
formatTimer(3661); // "01:01"

// 검증
isValidTimeFormat("09:30"); // true
isStartBeforeEnd("09:00", "10:00"); // true
```

### 점심시간 (shared/lib/lunch)

```typescript
// 11:40 ~ 12:40 점심시간 제외
calculateDurationExcludingLunch(660, 780); // 60분 (11:00~13:00에서 점심 제외)
isInLunchTime(720); // true (12:00)
```

### 세션 유틸 (shared/lib/session)

```typescript
getSessionMinutes(session); // 세션 소요 시간
calculateTotalMinutes(sessions); // 세션 목록 총 시간
createSession(startTs, endTs); // 새 세션 생성
sortSessionsByTime(sessions); // 시간순 정렬
```

---

## 네이밍 컨벤션

### 파일

-   컴포넌트: `PascalCase.tsx` (예: `WorkRecordTable.tsx`)
-   훅: `camelCase.ts` (예: `useWorkStore.ts`)
-   유틸리티: `snake_case.ts` (예: `time_utils.ts`)
-   타입: `domain.ts`, `timer.ts` (폴더별 집합)

### 코드

-   변수명: `snake_case` (예: `selected_date`, `work_name`)
-   함수명: `camelCase` (예: `handleAddNewWork`, `formatDuration`)
-   컴포넌트명: `PascalCase` (예: `WorkRecordTable`)
-   상수: `UPPER_SNAKE_CASE` (예: `DEFAULT_TASK_OPTIONS`)

---

## 개발 명령어

```bash
pnpm dev           # 개발 서버
pnpm build         # 프로덕션 빌드
pnpm test          # 테스트 (watch)
pnpm test:run      # 테스트 (단일 실행)
pnpm lint          # 린트
```

---

## 테스트 구조

```
test/
├── unit/                         # 순수 함수 유닛 테스트
│   ├── shared/lib/
│   │   ├── time/                 # 시간 유틸 테스트
│   │   └── lunch/                # 점심시간 계산 테스트
│   └── features/
│       ├── work-record/lib/      # 레코드 병합, 충돌 감지
│       ├── gantt-chart/lib/      # 슬롯 계산
│       ├── admin/lib/            # 문제 감지, 충돌 탐지
│       └── weekly-schedule/lib/  # 복사 포매터
│
├── component/                    # UI 컴포넌트 테스트
│   └── features/
│       ├── settings/             # 설정 탭 테스트
│       └── work-template/        # 템플릿 UI 테스트
│
├── components/                   # 기존 컴포넌트 통합 테스트
│
└── helpers/                      # 테스트 유틸리티
    └── mock_factory.ts           # createMockRecord, createMockSession 등
```

**테스트 현황**: 27개 파일, 504개 테스트 통과
