---
description: 릴리즈 준비, release, 배포 준비, 버전 업데이트, CHANGELOG 작성
globs:
alwaysApply: false
---

# 릴리즈 준비 가이드

> "릴리즈 준비해줘", "배포 준비", "버전 업데이트" 등의 요청 시 이 가이드를 따릅니다.

## ⚠️ 핵심 원칙

1. **모든 단계는 필수** - 스킵 절대 금지, 예외 없음
2. **순서 엄수** - 이전 단계 완료 전 다음 단계 진행 금지
3. **변경 있으면 테스트/문서도 변경** - 코드만 바꾸고 끝내지 않음
4. **사용자 확인 필수** - 각 단계 완료 후 진행 상황 보고

---

## 자동 실행 순서

### 1단계: 기존 테스트 실행 (필수)

```bash
pnpm test:run
```

-   **모든 테스트 통과 필수**
-   실패 시:
    -   기능 변경으로 인한 실패 → 테스트 케이스 수정
    -   버그로 인한 실패 → 코드 수정
-   수정 후 테스트 재실행하여 통과 확인
-   **통과 전까지 다음 단계 진행 금지**

---

### 2단계: 린트 및 빌드 확인

```bash
pnpm lint
pnpm build
```

-   에러 발생 시 수정 후 진행
-   **빌드 성공 전까지 다음 단계 진행 금지**

---

### 3단계: 테스트 케이스 추가 (필수 - 절대 스킵 금지)

> ⛔ **이 단계는 스킵할 수 없습니다.** 변경된 모든 기능에 대해 테스트를 추가해야 합니다.

#### 3-1. 변경 사항 목록화

이번 릴리즈에서 변경된 모든 항목을 나열합니다:

```
| 변경 항목 | 유형 | 테스트 필요 여부 | 테스트 파일 |
|-----------|------|------------------|-------------|
| 예: 세션 추가 기능 | 새 기능 | ✅ 필수 | ... |
```

#### 3-2. 테스트 케이스 작성 기준

| 변경 유형          | 필요한 테스트                                          |
| ------------------ | ------------------------------------------------------ |
| **새 기능 추가**   | 기능의 정상 동작을 검증하는 테스트 (필수)              |
| **기능 수정/개선** | 수정된 동작이 의도대로 작동하는지 검증 (필수)          |
| **버그 수정**      | 해당 버그가 재발하지 않도록 하는 회귀 테스트 (필수)    |
| **UI/스타일 변경** | 변경된 요소가 렌더링되는지 검증하는 렌더 테스트 (필수) |
| **스토어 변경**    | 상태 변경 및 액션 동작 테스트 (필수)                   |

#### 3-3. 테스트 파일 위치

| 대상                        | 테스트 파일                                |
| --------------------------- | ------------------------------------------ |
| 공유 라이브러리 (순수 함수) | `src/test/unit/shared/lib/**/*.test.ts`    |
| 기능별 순수 함수            | `src/test/unit/features/*/lib/*.test.ts`   |
| 기능별 UI 컴포넌트          | `src/test/component/features/*/*.test.tsx` |
| 기존 컴포넌트               | `src/test/components/*.test.tsx`           |
| 스토어 (useWorkStore)       | `src/test/store/useWorkStore.test.ts`      |
| 테스트 헬퍼                 | `src/test/helpers/mock_factory.ts`         |

#### 3-4. 테스트 스킵 가능 조건 (모두 충족해야 스킵 가능)

다음 조건을 **모두** 충족하는 경우에만 스킵 가능:

-   [ ] 단순 props 추가 (예: `format`, `locale` 등 라이브러리 내장 기능)
-   [ ] 로직 변경 없이 순수 마크업/텍스트만 변경
-   [ ] 외부 라이브러리가 이미 테스트하는 기능 사용
-   [ ] 사용자에게 **스킵 사유를 명시적으로 보고**

> ⚠️ UI 변경, 스토어 변경, 새 기능은 **절대 스킵 불가**

#### 3-5. 테스트 작성 후 검증

```bash
pnpm test:run
```

-   새로 작성한 테스트가 통과하는지 확인
-   기존 테스트가 영향받지 않았는지 확인
-   **모든 테스트 통과 전까지 다음 단계 진행 금지**

---

### 4단계: 변경 사항 분석 및 버전 결정

대화 맥락 또는 최근 커밋에서 변경 내용을 파악하고 버전 타입 결정:

| 변경 유형                                          | 버전  |
| -------------------------------------------------- | ----- |
| 데이터 구조 변경 (마이그레이션 필요)               | MAJOR |
| 새 페이지/라우트 추가                              | MINOR |
| 그 외 모든 변경 (버그 수정, 기능 개선, UI 변경 등) | PATCH |

**참고:** `.cursor/rules/versioning.mdc` 의 상세 기준 확인

---

### 5단계: 버전 파일 업데이트

**1. package.json**

```json
{
    "version": "X.Y.Z"
}
```

**2. src/constants/changelog.ts**

```typescript
export const CURRENT_VERSION = "X.Y.Z";

export const CHANGELOG: ChangelogEntry[] = [
    {
        version: "X.Y.Z",
        date: "YYYY-MM-DD", // 오늘 날짜
        title: "변경 제목",
        changes: [
            { type: "feature", description: "새로운 기능 설명" },
            { type: "fix", description: "버그 수정 설명" },
            { type: "improvement", description: "개선 사항 설명" },
        ],
    },
    // ... 기존 항목들
];
```

**변경 타입:**

| 타입        | 설명           | 이모지 |
| ----------- | -------------- | ------ |
| feature     | 새로운 기능    | ✨     |
| fix         | 버그 수정      | 🐛     |
| improvement | 기존 기능 개선 | 💪     |
| style       | UI/스타일 변경 | 🎨     |
| performance | 성능 개선      | ⚡     |
| docs        | 문서 변경      | 📝     |

**CHANGELOG 제외 대상:**

-   **관리자 기능**: `/admin`, `AdminSessionGrid.tsx` 등 (내부 디버깅/관리 용도)
-   **개발적인 내용**: 아키텍처, 테스트, 내부 구조 변경, 기술 용어 등

> **원칙**: 일반 사용자 관점에서 의미 있는 변경만 기록.

---

### 6단계: 문서 및 데모 동기화 (필수 - 절대 스킵 금지)

> ⛔ **이 단계는 스킵할 수 없습니다.** 변경된 기능에 해당하는 문서를 반드시 업데이트합니다.

#### 6-1. 문서 동기화 점검표

각 변경 항목에 대해 관련 문서를 확인하고 업데이트합니다:

| 기능 영역                   | 관련 문서            | 확인 |
| --------------------------- | -------------------- | ---- |
| 작업 기록, 타이머, 간트차트 | `daily-record.md`    | [ ]  |
| 작업 프리셋                 | `work-preset.md`     | [ ]  |
| 주간 일정                   | `weekly-schedule.md` | [ ]  |
| 건의사항 게시판             | `suggestions.md`     | [ ]  |
| 설정, 데이터 관리           | `settings.md`        | [ ]  |
| 단축키                      | `shortcuts.md`       | [ ]  |

#### 6-2. 문서 업데이트 기준

| 변경 유형        | 문서 업데이트                         |
| ---------------- | ------------------------------------- |
| **새 기능 추가** | 해당 문서에 기능 설명 추가 (필수)     |
| **기능 수정**    | 기존 설명이 맞지 않으면 수정 (필수)   |
| **UI 변경**      | 스크린샷/설명이 달라지면 수정 (필수)  |
| **버그 수정**    | 문서 내용이 달라지지 않으면 스킵 가능 |

#### 6-3. 데모 동기화 (guide-sync.mdc 참조)

다음 컴포넌트가 변경되었으면 데모 컴포넌트도 업데이트:

-   `WorkRecordTable` → `src/components/guide/DemoComponents.tsx`
-   `WorkTemplateList` → `src/components/guide/DemoComponents.tsx`
-   `DailyGanttChart` → `src/components/guide/DemoComponents.tsx`

#### 6-4. 문서 업데이트 스킵 조건

다음을 **모두** 충족해야 스킵 가능:

-   [ ] 순수 내부 로직 변경 (사용자에게 보이는 동작 변화 없음)
-   [ ] 기존 문서 설명이 여전히 정확함
-   [ ] 사용자에게 **스킵 사유를 명시적으로 보고**

---

### 7단계: 최종 확인

```bash
# 테스트 재실행
pnpm test:run

# 린트 재확인
pnpm lint
```

---

## 완료 보고 형식

모든 단계 완료 후 **반드시** 다음 형식으로 보고:

```
✅ 릴리즈 준비 완료

📦 버전: X.Y.Z (PATCH/MINOR/MAJOR)
📝 변경 내역: N개 항목

🧪 테스트 케이스:
   - 추가: N개
   - 수정: N개
   - 스킵: N개 (사유: ...)

📚 문서 동기화:
   - 업데이트: file1.md, file2.md
   - 스킵: file3.md (사유: ...)

🎨 데모 동기화: 완료/불필요 (사유)

✅ 최종 테스트: 통과 (N개)
✅ 린트: 통과
✅ 빌드: 성공
```

---

## 체크리스트 요약 (모든 항목 필수)

-   [ ] 1단계: `pnpm test:run` 통과
-   [ ] 2단계: `pnpm lint` 통과, `pnpm build` 성공
-   [ ] 3단계: 변경된 모든 기능에 테스트 추가 (스킵 시 사유 명시)
-   [ ] 4단계: 버전 타입 결정 (MAJOR/MINOR/PATCH)
-   [ ] 5단계: `package.json`, `changelog.ts` 업데이트
-   [ ] 6단계: 관련 문서 업데이트 (스킵 시 사유 명시)
-   [ ] 7단계: 최종 테스트 통과

---

## 위반 시 조치

-   단계를 스킵하면 **릴리즈 불가**
-   테스트 없이 기능 추가 시 **릴리즈 불가**
-   문서 업데이트 없이 새 기능 추가 시 **릴리즈 불가**
