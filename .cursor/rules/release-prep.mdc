---
description: 릴리즈 준비, release, 배포 준비, 버전 업데이트, CHANGELOG 작성
globs:
alwaysApply: false
---

# 릴리즈 준비 가이드

> "릴리즈 준비해줘", "배포 준비", "버전 업데이트" 등의 요청 시 이 가이드를 따릅니다.

## 자동 실행 순서

### 1단계: 테스트 실행 (필수 - 가장 먼저!)

```bash
pnpm test
```

-   **모든 테스트 통과 필수**
-   실패 시:
    -   기능 변경으로 인한 실패 → 테스트 케이스 수정
    -   버그로 인한 실패 → 코드 수정
-   수정 후 테스트 재실행하여 통과 확인

### 2단계: 린트 및 빌드 확인

```bash
pnpm lint
pnpm build
```

-   에러 발생 시 수정 후 진행

### 3단계: 테스트 케이스 추가 (필수)

> ⚠️ **원칙: 테스트 케이스는 기본적으로 추가한다.** 스킵은 예외적인 경우에만 허용.

이번 릴리즈에서 변경, 추가된 모든 기능에 대한 테스트 케이스를 작성합니다.

**테스트 케이스 작성 기준:**

| 변경 유형          | 테스트 케이스                                          |
| ------------------ | ------------------------------------------------------ |
| **새 기능 추가**   | 기능의 정상 동작을 검증하는 테스트                     |
| **기능 수정/개선** | 수정된 동작이 의도대로 작동하는지 검증                 |
| **버그 수정**      | 해당 버그가 재발하지 않도록 하는 회귀 테스트           |
| **UI/스타일 변경** | 변경된 요소가 렌더링되는지 검증하는 스냅샷/렌더 테스트 |

**테스트 스킵 가능 조건 (모두 충족 시에만):**

-   단순 props 추가 (예: `format`, `locale` 등 라이브러리 내장 기능)
-   로직 변경 없이 순수 마크업/텍스트만 변경
-   외부 라이브러리가 보장하는 기능 사용

> 스킵 시 반드시 **사용자에게 스킵 사유를 명시적으로 보고**해야 함.

**테스트 파일 위치:**

| 대상                        | 테스트 파일                                |
| --------------------------- | ------------------------------------------ |
| 공유 라이브러리 (순수 함수) | `src/test/unit/shared/lib/**/*.test.ts`    |
| 기능별 순수 함수            | `src/test/unit/features/*/lib/*.test.ts`   |
| 기능별 UI 컴포넌트          | `src/test/component/features/*/*.test.tsx` |
| 기존 컴포넌트               | `src/test/components/*.test.tsx`           |
| 스토어 (useWorkStore)       | `src/test/store/useWorkStore.test.ts`      |
| 테스트 헬퍼                 | `src/test/helpers/mock_factory.ts`         |

**테스트 작성 후:**

```bash
pnpm test
```

-   새로 작성한 테스트가 통과하는지 확인
-   기존 테스트가 영향받지 않았는지 확인

### 4단계: 변경 사항 분석 및 버전 결정

대화 맥락 또는 최근 커밋에서 변경 내용을 파악하고 버전 타입 결정:

| 변경 유형                                          | 버전  |
| -------------------------------------------------- | ----- |
| 데이터 구조 변경 (마이그레이션 필요)               | MAJOR |
| 새 페이지/라우트 추가                              | MINOR |
| 그 외 모든 변경 (버그 수정, 기능 개선, UI 변경 등) | PATCH |

**참고:** `.cursor/rules/versioning.mdc` 의 상세 기준 확인

### 5단계: 버전 파일 업데이트

**1. package.json**

```json
{
    "version": "X.Y.Z"
}
```

**2. src/constants/changelog.ts**

```typescript
export const CURRENT_VERSION = "X.Y.Z";

export const CHANGELOG: ChangelogEntry[] = [
    {
        version: "X.Y.Z",
        date: "YYYY-MM-DD", // 오늘 날짜
        title: "변경 제목",
        changes: [
            { type: "feature", description: "새로운 기능 설명" },
            { type: "fix", description: "버그 수정 설명" },
            { type: "improvement", description: "개선 사항 설명" },
        ],
    },
    // ... 기존 항목들
];
```

**변경 타입:**

| 타입        | 설명           | 이모지 |
| ----------- | -------------- | ------ |
| feature     | 새로운 기능    | ✨     |
| fix         | 버그 수정      | 🐛     |
| improvement | 기존 기능 개선 | 💪     |
| style       | UI/스타일 변경 | 🎨     |
| performance | 성능 개선      | ⚡     |
| docs        | 문서 변경      | 📝     |

**CHANGELOG 제외 대상:**

-   **관리자 기능**: `/admin`, `AdminSessionGrid.tsx` 등 (내부 디버깅/관리 용도)
-   **개발적인 내용**: 아키텍처, 테스트, 내부 구조 변경, 기술 용어 등
    -   예: FSD 아키텍처 도입, 테스트 커버리지, Firestore 스키마 변경, Service Worker, 훅 이름

> **원칙**: 일반 사용자 관점에서 의미 있는 변경만 기록. "어떻게 구현했는지"가 아닌 "무엇이 달라졌는지" 기술.

### 6단계: 문서 및 데모 동기화 확인

**문서 동기화 (guide-sync.mdc 참조):**

-   UI 변경 시 → 관련 `src/docs/*.md` 파일 업데이트 필요 여부 확인
-   새 기능 추가 시 → 해당 문서에 설명 추가

| 기능 영역                   | 관련 문서            |
| --------------------------- | -------------------- |
| 작업 기록, 타이머, 간트차트 | `daily-record.md`    |
| 작업 프리셋                 | `work-preset.md`     |
| 주간 일정                   | `weekly-schedule.md` |
| 건의사항 게시판             | `suggestions.md`     |
| 설정, 데이터 관리           | `settings.md`        |
| 단축키                      | `shortcuts.md`       |

**데모 동기화 (demo-sync.mdc 참조):**

-   `WorkRecordTable`, `WorkTemplateList`, `DailyGanttChart` 변경 시
-   → `src/components/guide/DemoComponents.tsx` 업데이트 필요 여부 확인

### 7단계: 최종 확인

```bash
# 테스트 재실행
pnpm test

# 린트 재확인
pnpm lint
```

모든 단계 완료 후 사용자에게 보고:

```
✅ 릴리즈 준비 완료

- 버전: X.Y.Z (PATCH/MINOR/MAJOR)
- 변경 내역: N개 항목
- 테스트 케이스: N개 추가 / 스킵 (사유: ...)
- 테스트: 통과
- 문서 동기화: 완료/불필요
- 데모 동기화: 완료/불필요
```

---

## 체크리스트 요약

-   [ ] `pnpm test` 통과
-   [ ] `pnpm lint` 통과
-   [ ] `pnpm build` 성공
-   [ ] 테스트 케이스 추가 (스킵 시 사유 명시)
-   [ ] 버전 타입 결정 (MAJOR/MINOR/PATCH)
-   [ ] `package.json` version 업데이트
-   [ ] `src/constants/changelog.ts` 업데이트
-   [ ] 문서 동기화 확인 (필요시)
-   [ ] 데모 컴포넌트 동기화 확인 (필요시)
-   [ ] 최종 테스트 통과
